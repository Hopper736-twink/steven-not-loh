<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Стивен — ретро управление</title>

<style>
body{margin:0;background:#111;overflow:hidden}
#game{position:relative;width:100vw;height:100vh}
canvas{width:100%;height:100%}

/* UI */
#ui{position:absolute;top:8px;left:8px;right:8px;display:flex;justify-content:space-between;color:white;font-family:monospace}
.box{background:#000a;padding:6px;border-radius:6px;font-size:12px}
.hearts{display:flex;gap:4px}
.heart{width:14px;height:14px;background:red}
.empty{background:#333}

/* TOUCH CONTROLS */
#controls{
position:absolute;
bottom:10px;
left:0;
right:0;
display:flex;
justify-content:space-between;
padding:10px;
pointer-events:auto;
}

.pad, .actions{
display:flex;
gap:10px;
}

.btn{
width:60px;
height:60px;
background:#222;
border:3px solid #555;
border-radius:12px;
color:white;
font-size:24px;
display:flex;
align-items:center;
justify-content:center;
user-select:none;
}

.btn:active{background:#555}
</style>
</head>

<body>
<div id="game">

<canvas id="c" width="800" height="600"></canvas>

<div id="ui">
  <div class="box"><div>HP</div><div class="hearts" id="hp"></div></div>
  <div class="box"><div id="wName"></div><div>урон <span id="wDmg"></span></div></div>
</div>

<!-- TOUCH CONTROLS -->
<div id="controls">
  <div class="pad">
    <div class="btn" id="left">◀</div>
    <div class="btn" id="right">▶</div>
  </div>
  <div class="actions">
    <div class="btn" id="jump">A</div>
    <div class="btn" id="attack">B</div>
  </div>
</div>

</div>

<script>
const c=document.getElementById("c");
const x=c.getContext("2d");

const W=800,H=600,G=480;

let keys={},run=true,last=0;
const fps=1000/60;

const weapons=[
{name:"МЕЧ",dmg:6,cd:20},
{name:"БУЛАВА",dmg:18,cd:45},
{name:"АРБАЛЕТ",dmg:12,cd:30}
];

const player={
x:100,y:400,w:40,h:60,
vx:0,vy:0,
hp:50,max:50,
spd:5,j:14,
cd:0,w:0
};

const boss={x:600,y:410,w:50,h:70,hp:200};

function hearts(){
hp.innerHTML="";
for(let i=0;i<player.max/2;i++){
const d=document.createElement("div");
d.className="heart"+(i>=player.hp/2?" empty":"");
hp.appendChild(d);
}}

function weaponUI(){
wName.textContent=weapons[player.w].name;
wDmg.textContent=weapons[player.w].dmg;
}

function phys(o){
o.vy+=0.7;
o.x+=o.vx;
o.y+=o.vy;
if(o.y+o.h>=G){o.y=G-o.h;o.vy=0}
}

function attack(){
if(player.cd>0)return;
player.cd=weapons[player.w].cd;
const dx=(boss.x+25)-(player.x+20);
const dy=(boss.y+35)-(player.y+30);
if(dx*dx+dy*dy<10000)boss.hp-=weapons[player.w].dmg;
}

function draw(){
x.fillStyle="#87ceeb";x.fillRect(0,0,W,H);
x.fillStyle="#654321";x.fillRect(0,G,W,200);
x.fillStyle="#FFD700";x.fillRect(player.x,player.y,player.w,player.h);
x.fillStyle="#888";x.fillRect(boss.x,boss.y,boss.w,boss.h);
}

function loop(t){
if(t-last<fps){requestAnimationFrame(loop);return;}
last=t;

player.vx=0;
if(keys.left)player.vx=-player.spd;
if(keys.right)player.vx=player.spd;
if(keys.jump && player.y+player.h>=G)player.vy=-player.j;
if(keys.attack)attack();

player.cd=Math.max(0,player.cd-1);
phys(player);

draw(); hearts(); weaponUI();
requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* TOUCH EVENTS */
const bind=(id,key)=>{
const b=document.getElementById(id);
b.ontouchstart=e=>{e.preventDefault();keys[key]=true};
b.ontouchend=e=>{e.preventDefault();keys[key]=false};
};

bind("left","left");
bind("right","right");
bind("jump","jump");
bind("attack","attack");

/* KEYBOARD */
onkeydown=e=>{
if(e.key==="a")keys.left=true;
if(e.key==="d")keys.right=true;
if(e.key==="w")keys.jump=true;
if(e.key===" ")keys.attack=true;
if(e.key>="1"&&e.key<="3")player.w=e.key-1;
};
onkeyup=e=>{
if(e.key==="a")keys.left=false;
if(e.key==="d")keys.right=false;
if(e.key==="w")keys.jump=false;
if(e.key===" ")keys.attack=false;
};

hearts(); weaponUI();
</script>
</body>
</html>
